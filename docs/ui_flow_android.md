# 红蜘蛛AI医疗助手 - Android 端交互流程

## 1. 打开应用

1. 用户点击图标进入应用
2. 显示主界面：
   - 顶部：标题栏「红蜘蛛AI医疗助手」
   - 中间：聊天消息列表（空）
   - 底部：输入框 + 发送按钮

## 2. 输入与发送

1. 用户在输入框中输入问题，例如：
   - 「感冒的症状是什么？」
   - 「我发烧两天了怎么办？」
2. 点击「发送」按钮：
   - 将用户输入追加到消息列表右侧（用户气泡）
   - 在消息列表左侧追加一条「红蜘蛛正在思考中...」的加载消息
   - 禁用发送按钮，防止重复点击

## 3. 调用后端 API

1. 前端通过 `ApiClient` 调用：

```kotlin
POST /api/chat
Body: { "question": "..." }
```

2. 等待服务端响应：
   - 若网络正常且服务正常，通常 1–5 秒内返回
   - 若超时或错误，将展示错误提示

## 4. 展示结果

### 4.1 正常回答（status = "ok"）

- 移除「正在思考中」加载消息
- 从响应中读取 `data.answer`
- 在左侧追加 AI 消息气泡显示完整回答
- 自动滚动到底部

### 4.2 紧急提示（status = "emergency"）

- 移除「正在思考中」加载消息
- 在左侧追加「紧急提示」消息气泡，使用醒目颜色（橙红色）
- 弹出 Toast 或对话框提示用户「检测到紧急症状，请立即就医」

### 4.3 错误情况（status = "error" 或网络异常）

- 移除「正在思考中」加载消息
- 在左侧追加一条错误消息气泡，例如：
  - 「抱歉，服务暂时不可用，请稍后重试。」
  - 「网络错误：xxx」
- 弹出 Toast 提示用户检查网络或稍后再试

## 5. 继续对话

1. 恢复发送按钮可用状态
2. 输入框自动获得焦点，方便用户继续输入
3. 聊天历史保留在当前会话中，用户可以上下滚动查看

## 6. 交互细节

- 消息类型：
  - 用户消息：右对齐，橙色背景
  - AI 消息：左对齐，灰色背景
  - 加载消息：左对齐，灰色背景 + 斜体
  - 错误消息：左对齐，红色背景
  - 紧急提示：左对齐，橙红色背景 + 粗体

- 滚动行为：
  - 每次追加新消息后，自动滚动到列表底部

- 性能优化：
  - 使用 RecyclerView + ViewHolder 复用机制

## 7. 与后端的约定

- 所有请求均为 JSON 格式
- 所有响应均符合 `ChatResponse` 结构
- 高危症状由后端统一判断并通过 `status = "emergency"` + 特殊 `answer` 提示

